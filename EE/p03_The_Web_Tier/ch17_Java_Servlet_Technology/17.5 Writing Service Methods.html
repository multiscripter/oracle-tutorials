<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>17.5 Написание методов обслуживания</title>
</head>
<body>
    <h1>17.5 Написание методов обслуживания</h1>
    <p>
        Служба, предоставляемая сервлетом, реализуется: в методе <code>service</code> класса
        <code>GenericServlet</code>, в&nbsp;методах do<i>Method</i> (где <i>Method</i> может принимать значения
        <code>Get, Delete, Options, Post, Put</code> или <code>Trace</code>) объекта <code>HttpServlet</code>,
        или в&nbsp;любых других протоколо-специфических методах, определённых классом, реализующим интерфейс
        <code>Servlet</code>. Термин <b>службный метод (service method)</b> используется для любого метода
        в&nbsp;классе сервлета, который обслуживает клиента.
    </p>
    <p>
        Общая схема службного метода заключается в&nbsp;извлечении информации из&nbsp;запроса, доступе
        к&nbsp;внешним ресурсам и&nbsp;затем заполнении ответа на&nbsp;основе этой информации.
        Для HTTP-сервлетов правильная процедура для заполнения ответа заключается в&nbsp;следующем:
    </p>
    <ol>
        <li>
            <p>Извлечь выходной поток из&nbsp;ответа.</p>
        </li>
        <li>
            <p>Заполнить заголовки ответов.</p>
        </li>
        <li>
            <p>Записывайть содержимое тела в&nbsp;выходной поток.</p>
        </li>
    </ol>
    <p>
        Заголовки ответов всегда должны быть установлены до&nbsp;того, как ответ будет выполнен.
        Веб-контейнер будет игнорировать любую попытку установить или добавить заголовки после того,
        как ответ будет исправлен. В&nbsp;следующих двух разделах описывается, как получать информацию
        от&nbsp;запросов и&nbsp;генерировать ответы.
    </p>
    <h2>17.5.1 Получение информации из&nbsp;запросов</h2>
    <p>
        Запрос содержит данные, переданные между клиентом и&nbsp;сервлетом. Все запросы реализуют интерфейс
        <code>ServletRequest</code>. Этот интерфейс определяет методы доступа к&nbsp;следующей информации:
    </p>
    <ul>
        <li>
            <p>
                Параметры, которые обычно используются для передачи информации между клиентами и&nbsp;сервлетами
            </p>
        </li>
        <li>
            <p>
                Атрибуты, содержащие объекты, которые обычно используются для передачи информации между
                веб-контейнером и сервлетом или между взаимодействующими сервлетами
            </p>
        </li>
        <li>
            <p>
                Информация о&nbsp;протоколе, используемом для связи запроса и&nbsp;о&nbsp;клиенте
                и&nbsp;сервере, участвующих в&nbsp;запросе
            </p>
        </li>
        <li>
            <p>
                Информация, относящаяся к&nbsp;локализации
            </p>
        </li>
    </ul>
    <p>
        Вы&nbsp;также можете получить входной поток из&nbsp;запроса и&nbsp;вручную проанализировать данные.
        Чтобы прочитать символьные данные, используйте объект <code>BufferedReader</code>, возвращенный методом
        <code>getReader</code> запроса. Чтобы прочитать двоичные данные, используйте
        <code>ServletInputStream</code>, возвращаемый <code>getInputStream</code>.
    </p>
    <pre>
http://[host]:[port][request-path]?[query-string]
    </pre>
    <p>Путь запроса также состоит из&nbsp;следующих элементов:</p>
    <ul>
        <li>
            <p>
                <b>Context path</b> (путь контекста): конкатенация косой черты (/) с&nbsp;корнем контекста
                веб-приложения сервлета.
            </p>
        </li>
        <li>
            <p>
                <b>Servlet path</b> (путь сервлета): часть пути, которая соответствует псевдониму компонента,
                который активировал этот запрос. Этот путь начинается с&nbsp;косой черты (/).
            </p>
        </li>
        <li>
            <p>
                <b>Path info</b> (информация о&nbsp;пути): часть пути запроса, которая не&nbsp;является
                частью пути контекста или пути сервлета.
            </p>
        </li>
    </ul>
    <p>
        Вы&nbsp;можете использовать методы <code>getContextPath, getServletPath</code> и&nbsp;
        <code>getPathInfo</code> интерфейса <code>HttpServletRequest</code> для доступа к&nbsp;этой информации.
        За&nbsp;исключением различий в&nbsp;кодировке URL-адреса между URI запроса и&nbsp;частями пути,
        URI запроса всегда состоит из&nbsp;пути контекста плюс путь сервлета плюс информация о&nbsp;пути.
    </p>
    <p>
        Строки запроса состоят из&nbsp;набора параметров и&nbsp;значений. Индивидуальные параметры извлекаются
        из&nbsp;запроса с&nbsp;использованием метода <code>getParameter</code>.
        Существует два способа генерации строк запроса:
    </p>
    <ul>
        <li>
            <p>Строка запроса может явно отображаться на&nbsp;веб-странице.</p>
        </li>
        <li>
            <p>Строка запроса добавляется к&nbsp;URL-адресу, когда отправляется форма с&nbsp;методом GET HTTP.</p>
        </li>
    </ul>
    <h2>17.5.2 Построение ответов</h2>
    <p>
        Ответ содержит данные, передаваемые между сервером и&nbsp;клиентом. Все ответы реализуют интерфейс
        <code>ServletResponse</code>. Этот интерфейс определяет методы, которые позволяют выполнять следующие
        действия:
    </p>
    <ul>
        <li>
            <p>
                Получить выходной поток, используемый для передачи данных клиенту. Чтобы отправить символьные
                данные, используйте <code>PrintWriter</code>, возвращаемый методом <code>getWriter</code> ответа.
                Чтобы отправить двоичные данные в&nbsp;ответ тела на&nbsp;многопользовательские почтовые
                расширения (MIME), используйте <code>ServletOutputStream</code>, возвращаемый
                <code>getOutputStream</code>. Чтобы смешивать двоичные и&nbsp;текстовые данные
                используйте <code>ServletOutputStream</code> и&nbsp;управляйте разделами символов вручную.
            </p>
        </li>
        <li>
            <p>
                Укажите тип содержимого (например, text/html), возвращаемый ответом с&nbsp;помощью метода
                <code>setContentType(String)</code>. Этот метод должен быть вызван до&nbsp;того, как будет
                выполнен ответ. Регистр имен типов контента хранится в&nbsp;уполномоченной службе Интернета (IANA)
                <a target="_blank" href="http://www.iana.org/assignments/media-types/">http://www.iana.org/assignments/media-types/</a>
            </p>
        </li>
        <li>
            <p>
                Укажите, следует&nbsp;ли буферировать вывод с&nbsp;помощью метода <code>setBufferSize(int)</code>.
                По&nbsp;умолчанию любой контент, записанный в&nbsp;выходной поток, немедленно отправляется клиенту.
                Буферизация позволяет контенту писать, прежде чем что-либо будет отправлено обратно клиенту,
                тем самым предоставив сервлету больше времени для установки соответствующих кодов состояния
                и&nbsp;заголовков или пересылки на&nbsp;другой веб-ресурс. Метод должен быть вызван до&nbsp;того,
                как будет записан любой контент или до&nbsp;того, как будет получен ответ.
            </p>
        </li>
        <li>
            <p>
                Установите информацию о&nbsp;локализации, такую как языковая кодировка и&nbsp;кодировка символов.
                Подробнее см. Главу&nbsp;20 &laquo;Интернационализация и&nbsp;локализация веб-приложений&raquo;.
            </p>
        </li>
    </ul>
    <p>
        Объекты ответа HTTP, <code>javax.servlet.http.HttpServletResponse</code>, имеют поля,
        представляющие заголовки HTTP, например следующие:
    </p>
    <ul>
        <li>
            <p>
                Коды состояния, используемые для указания причины, по&nbsp;которой запрос
                не&nbsp;выполняется, или что запрос был перенаправлен.
            </p>
        </li>
        <li>
            <p>
                Файлы cookie, используемые для хранения информации о&nbsp;конкретном приложении
                на&nbsp;клиенте. Иногда файлы cookie используются для поддержки идентификатора для отслеживания
                сеанса пользователя (см. раздел &laquo;Отслеживание сеансов&raquo;).
            </p>
        </li>
    </ul>
</body>
</html>